# =============================================================================
# Pre-commit Configuration for Security and Quality Checks
# =============================================================================
# Install: pip install pre-commit
# Setup: pre-commit install
# Run manually: pre-commit run --all-files

repos:
  # Terraform formatting
  - repo: https://github.com/antonbabenko/pre-commit-terraform
    rev: v1.105.0
    hooks:
      - id: terraform_fmt
        name: Terraform Format
        description: Rewrites all Terraform files to canonical format

      - id: terraform_validate
        name: Terraform Validate
        description: Validates all Terraform files

      - id: terraform_docs
        name: Terraform Docs
        description: Generates documentation from Terraform modules
        args:
          - '--args=--lockfile=false'

      - id: terraform_tflint
        name: Terraform Lint
        description: Lints Terraform files with TFLint
        args:
          - '--args=--config=__GIT_WORKING_DIR__/.tflint.hcl'

  # Security scanning with Checkov
  - repo: https://github.com/bridgecrewio/checkov
    rev: 3.2.501
    hooks:
      - id: checkov
        name: Checkov Security Scan
        description: Scans Terraform for security and compliance issues
        args:
          - --quiet
          - --framework=terraform
          - --skip-check=CKV_AWS_119  # Skip DynamoDB auto-scaling check if using PAY_PER_REQUEST
          - --skip-check=CKV_AWS_28   # Skip DynamoDB encryption check (we have our own)

  # Security scanning with tfsec
  - repo: https://github.com/aquasecurity/tfsec
    rev: v1.28.14
    hooks:
      - id: tfsec
        name: TFSec Security Scan
        description: Security scanner for Terraform
        args:
          - --exclude-downloaded-modules
          - --minimum-severity=MEDIUM

  # YAML linting
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.38.0
    hooks:
      - id: yamllint
        name: YAML Lint
        args:
          - --format=parsable
          - --strict

  # General file checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: trailing-whitespace
        name: Trim Trailing Whitespace

      - id: end-of-file-fixer
        name: Fix End of Files

      - id: check-yaml
        name: Check YAML

      - id: check-added-large-files
        name: Check for Large Files
        args: ['--maxkb=1024']

      - id: check-merge-conflict
        name: Check for Merge Conflicts

      - id: detect-private-key
        name: Detect Private Keys

      - id: mixed-line-ending
        name: Mixed Line Ending

  # Markdown linting
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.47.0
    hooks:
      - id: markdownlint
        name: Markdown Lint
        args:
          - --fix
          - --disable=MD013  # Line length
          - --disable=MD033  # Inline HTML
